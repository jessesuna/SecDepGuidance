<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Deployment Assessment</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        #questionContainer {
            margin-bottom: 20px;
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            cursor: pointer;
        }
        #results {
            margin-top: 20px;
        }
        .deployed {
            fill: #90EE90 !important;
        }
        .not-deployed {
            fill: #FFB6C1 !important;
        }
    </style>
</head>
<body>
    <div id="questionContainer">
        <h2 id="currentQuestion"></h2>
        <button onclick="answer(true)">Yes</button>
        <button onclick="answer(false)">No</button>
    </div>
    <div id="results" style="display: none;">
        <h2>Assessment Results</h2>
        <div id="mermaidChart"></div>
        <div id="recommendations"></div>
    </div>

    <script>
        mermaid.initialize({ startOnLoad: true });

        const questions = [
            { id: 'CloudID', text: 'Have you configured Cloud Identity?' },
            { id: 'MFA', text: 'Have you deployed Multifactor Authentication?' },
            { id: 'CA', text: 'Have you configured Conditional Access Policies?' },
            { id: 'IntuneEnroll', text: 'Have you enrolled devices into management?' },
            { id: 'IntuneCompPol', text: 'Have you configured compliance policies?' },
            { id: 'OnboardDevices', text: 'Have you onboarded Windows devices into Microsoft 365?' },
            { id: 'DSPM', text: 'Have you deployed Microsoft Purview DSPM?' },
            { id: 'EndpointDLP', text: 'Have you configured Endpoint DLP Policy?' },
            { id: 'XDR', text: 'Have you deployed M365 Defender for XDR?' }
        ];

        let currentQuestionIndex = 0;
        const deploymentStatus = {};

        function showQuestion() {
            if (currentQuestionIndex < questions.length) {
                document.getElementById('currentQuestion').textContent = 
                    questions[currentQuestionIndex].text;
            } else {
                showResults();
            }
        }

        function answer(isYes) {
            deploymentStatus[questions[currentQuestionIndex].id] = isYes;
            currentQuestionIndex++;
            showQuestion();
        }

        function generateMermaidDiagram() {
            return `
            flowchart LR
                %% Core Zero Trust 
                Zero[Zero Trust/Security Suite Deployed]
                Data[Protect and govern sensitive data]
                Threats[Defend against threats]
                Foundation[Zero trust foundation]

                Foundation-->Zero
                Data-->Zero
                Threats-->Zero

                %% Data Security
                DSPM[Microsoft Purview DSPM]-->Data
                EndpointDLP[Endpoint DLP Policy]-->Data

                %% Threats
                XDR[M365 Defender for XDR]-->Threats

                %% Foundations
                IntuneEnroll[Enroll devices into management]-->IntuneCompPol[Configure compliance policies]
                MFA[Deploy Multifactor Authentication]-->CA[Configure Conditional Access Policies]
                CloudID[Configure Cloud Identity]-->MFA
                OnboardDevices[Onboard Windows devices]-->CA
                IntuneCompPol-->OnboardDevices
                CA-->Foundation

                classDef deployed fill:#90EE90,stroke:#333
                classDef notDeployed fill:#FFB6C1,stroke:#333

                ${Object.entries(deploymentStatus).map(([id, isDeployed]) => 
                    `class ${id} ${isDeployed ? 'deployed' : 'notDeployed'}`
                ).join('\n')}
            `;
        }

        function generateRecommendations() {
            let recommendations = '## Recommended Next Steps\n\n';
            
            if (!deploymentStatus['CloudID']) {
                recommendations += '### Identity & Access Management Priority\n' +
                    '- Configure Cloud Identity as your foundation\n' +
                    '- Review Entra ID Protection features\n' +
                    '- Implement basic identity management\n\n';
            }

            if (!deploymentStatus['MFA'] && deploymentStatus['CloudID']) {
                recommendations += '### Security Enhancement Required\n' +
                    '- Deploy Multifactor Authentication immediately\n' +
                    '- Configure MFA for all users\n' +
                    '- Set up conditional access policies\n\n';
            }

            if (!deploymentStatus['IntuneEnroll']) {
                recommendations += '### Device Management Needed\n' +
                    '- Begin device enrollment in Intune\n' +
                    '- Configure basic device compliance policies\n' +
                    '- Set up device management policies\n\n';
            }

            if (!deploymentStatus['XDR']) {
                recommendations += '### Threat Protection Recommendations\n' +
                    '- Deploy Microsoft 365 Defender (XDR)\n' +
                    '- Configure EDR capabilities\n' +
                    '- Set up advanced threat protection\n\n';
            }

            return recommendations;
        }

        function showResults() {
            document.getElementById('questionContainer').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            
            const mermaidDiv = document.getElementById('mermaidChart');
            mermaidDiv.innerHTML = `<div class="mermaid">${generateMermaidDiagram()}</div>`;
            
            const recommendationsDiv = document.getElementById('recommendations');
            recommendationsDiv.innerHTML = marked.parse(generateRecommendations());
            
            mermaid.init();
        }

        // Start the questionnaire
        showQuestion();
    </script>
</body>
</html>
